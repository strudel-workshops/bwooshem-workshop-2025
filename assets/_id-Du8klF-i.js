import{g as _,a as E,d as j,e as N,_ as z,b as $,j as e,s as R,h as L,k as B,a1 as U,a2 as J,B as O,C as V,S as o,P as v,T as n,a3 as q,a4 as H,a5 as d,a6 as Q,a7 as k,a8 as T,a9 as W}from"./index-DCknfy59.js";import{P as X}from"./PageHeader-2BoK6B7_.js";import{u as Y}from"./useDetailQuery-CpAdToDN.js";import{u as G}from"./useCSVStatistics-DC6xo8Eb.js";import{P as A}from"./react-plotly-tx3w8jEW.js";import{M as g}from"./MenuItem-BmCg593V.js";import"./useQuery-D3s8ffCS.js";import"./index-Chjiymov.js";import"./dividerClasses-BaX6EgVd.js";function K(i){return _("MuiTableContainer",i)}E("MuiTableContainer",["root"]);const Z=["className","component"],ee=i=>{const{classes:t}=i;return B({root:["root"]},K,t)},ae=R("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(i,t)=>t.root})({width:"100%",overflowX:"auto"}),te=j.forwardRef(function(t,s){const h=N({props:t,name:"MuiTableContainer"}),{className:c,component:u="div"}=h,p=z(h,Z),m=$({},h,{component:u}),f=ee(m);return e.jsx(ae,$({ref:s,as:u,className:L(f.root,c),ownerState:m},p))});function re(i){return _("MuiTableHead",i)}E("MuiTableHead",["root"]);const ie=["className","component"],se=i=>{const{classes:t}=i;return B({root:["root"]},re,t)},ne=R("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(i,t)=>t.root})({display:"table-header-group"}),le={variant:"head"},I="thead",oe=j.forwardRef(function(t,s){const h=N({props:t,name:"MuiTableHead"}),{className:c,component:u=I}=h,p=z(h,ie),m=$({},h,{component:u}),f=se(m);return e.jsx(U.Provider,{value:le,children:e.jsx(ne,$({as:u,className:L(f.root,c),ref:s,role:u===I?null:"rowgroup",ownerState:m},p))})}),ce={"San Jose":{lat:37.3382,lon:-121.8863},Berkeley:{lat:37.8715,lon:-122.273},Sacramento:{lat:38.5816,lon:-121.4944}};function de(i,t,s){const[h,c]=j.useState([]),[u,p]=j.useState(!1),[m,f]=j.useState(null);return j.useEffect(()=>{if(!i||!t||!s){c([]),p(!1),f(null);return}(async()=>{p(!0),f(null);try{const l=ce[i];if(!l)throw new Error(`Unknown city: ${i}`);const M=`https://archive-api.open-meteo.com/v1/archive?latitude=${l.lat}&longitude=${l.lon}&start_date=${t}&end_date=${s}&hourly=temperature_2m&temperature_unit=fahrenheit&timezone=America/Los_Angeles`,y=await fetch(M);if(!y.ok)throw new Error(`Failed to fetch weather data: ${y.statusText}`);const w=await y.json();if(!w.hourly||!w.hourly.time||!w.hourly.temperature_2m)throw new Error("Invalid weather data format");const x=w.hourly.time.map((D,P)=>({datetime:D,temperature:w.hourly.temperature_2m[P]}));c(x)}catch(l){f(l instanceof Error?l.message:"Failed to fetch weather data"),c([])}finally{p(!1)}})()},[i,t,s]),{data:h,loading:u,error:m}}function he({filename:i}){const{stats:t,data:s,monthlyStats:h,hourlyProfile:c,weekdayHourlyProfile:u,weekendHourlyProfile:p,monthlyHourlyProfiles:m,loading:f,error:S}=G(i),[l,M]=j.useState("average"),[y,w]=j.useState("all"),[x,D]=j.useState("all"),[P,F]=j.useState("San Jose"),C=s.length>0?{startDate:s[0].datetime.split(" ")[0],endDate:s[s.length-1].datetime.split(" ")[0]}:null,b=de(P,(C==null?void 0:C.startDate)||null,(C==null?void 0:C.endDate)||null);return i?f?e.jsx(v,{sx:{padding:2},children:e.jsx(n,{children:"Loading CSV data..."})}):S?e.jsx(v,{sx:{padding:2},children:e.jsxs(n,{color:"error",children:["Error: ",S]})}):t?e.jsxs(o,{spacing:3,children:[e.jsx(v,{sx:{padding:2},children:e.jsxs(o,{spacing:2,children:[e.jsxs(n,{variant:"h6",fontWeight:"bold",children:["Data Summary for ",i,".csv"]}),e.jsxs(o,{spacing:1,children:[e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(n,{fontWeight:"bold",children:"Number of datapoints:"}),e.jsx(n,{children:t.count.toLocaleString()})]}),e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(n,{fontWeight:"bold",children:"Average Price ($/kWh):"}),e.jsxs(n,{children:["$",t.average]})]}),e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(n,{fontWeight:"bold",children:"Median Price ($/kWh):"}),e.jsxs(n,{children:["$",t.median]})]}),e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(n,{fontWeight:"bold",children:"Maximum Price ($/kWh):"}),e.jsxs(n,{children:["$",t.max]})]}),e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(n,{fontWeight:"bold",children:"Minimum Price ($/kWh):"}),e.jsxs(n,{children:["$",t.min]})]})]})]})}),e.jsx(v,{sx:{padding:2},children:e.jsxs(o,{spacing:2,children:[e.jsx(n,{variant:"h6",fontWeight:"bold",children:"Monthly Statistics"}),e.jsx(te,{children:e.jsxs(q,{children:[e.jsx(oe,{children:e.jsxs(H,{children:[e.jsx(d,{children:e.jsx("strong",{children:"Month"})}),e.jsx(d,{align:"right",children:e.jsx("strong",{children:"Average ($/kWh)"})}),e.jsx(d,{align:"right",children:e.jsx("strong",{children:"Median ($/kWh)"})}),e.jsx(d,{align:"right",children:e.jsx("strong",{children:"Max ($/kWh)"})}),e.jsx(d,{align:"right",children:e.jsx("strong",{children:"Min ($/kWh)"})}),e.jsx(d,{align:"right",children:e.jsx("strong",{children:"Data Points"})})]})}),e.jsx(Q,{children:h.map(a=>e.jsxs(H,{hover:!0,children:[e.jsx(d,{children:a.month}),e.jsxs(d,{align:"right",children:["$",a.average]}),e.jsxs(d,{align:"right",children:["$",a.median]}),e.jsxs(d,{align:"right",children:["$",a.max]}),e.jsxs(d,{align:"right",children:["$",a.min]}),e.jsx(d,{align:"right",children:a.count.toLocaleString()})]},a.month))})]})})]})}),e.jsx(v,{sx:{padding:2},children:e.jsxs(o,{spacing:2,children:[e.jsxs(o,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[e.jsx(n,{variant:"h6",fontWeight:"bold",children:"Typical Daily Profile"}),e.jsxs(o,{direction:"row",spacing:2,flexWrap:"wrap",children:[e.jsxs(k,{size:"small",sx:{minWidth:150},children:[e.jsx(T,{id:"month-filter-label",children:"Time Period"}),e.jsxs(W,{labelId:"month-filter-label",id:"month-filter-select",value:y,label:"Time Period",onChange:a=>w(a.target.value),children:[e.jsx(g,{value:"all",children:"All Data"}),m.map(a=>e.jsx(g,{value:a.month,children:a.month},a.month))]})]}),e.jsxs(k,{size:"small",sx:{minWidth:120},children:[e.jsx(T,{id:"day-type-label",children:"Day Type"}),e.jsxs(W,{labelId:"day-type-label",id:"day-type-select",value:x,label:"Day Type",onChange:a=>D(a.target.value),children:[e.jsx(g,{value:"all",children:"All Days"}),e.jsx(g,{value:"weekday",children:"Weekday"}),e.jsx(g,{value:"weekend",children:"Weekend"})]})]}),e.jsxs(k,{size:"small",sx:{minWidth:120},children:[e.jsx(T,{id:"hourly-metric-label",children:"Metric"}),e.jsxs(W,{labelId:"hourly-metric-label",id:"hourly-metric-select",value:l,label:"Metric",onChange:a=>M(a.target.value),children:[e.jsx(g,{value:"average",children:"Average"}),e.jsx(g,{value:"median",children:"Median"})]})]})]})]}),e.jsx(A,{data:[{x:(()=>{if(y==="all")return x==="weekday"?u.map(a=>a.hour):x==="weekend"?p.map(a=>a.hour):c.map(a=>a.hour);{const a=m.find(r=>r.month===y);return a?x==="weekday"?a.weekdayProfile.map(r=>r.hour):x==="weekend"?a.weekendProfile.map(r=>r.hour):a.profile.map(r=>r.hour):c.map(r=>r.hour)}})(),y:(()=>{if(y==="all")return x==="weekday"?u.map(a=>l==="average"?a.averagePrice:a.medianPrice):x==="weekend"?p.map(a=>l==="average"?a.averagePrice:a.medianPrice):c.map(a=>l==="average"?a.averagePrice:a.medianPrice);{const a=m.find(r=>r.month===y);return a?x==="weekday"?a.weekdayProfile.map(r=>l==="average"?r.averagePrice:r.medianPrice):x==="weekend"?a.weekendProfile.map(r=>l==="average"?r.averagePrice:r.medianPrice):a.profile.map(r=>l==="average"?r.averagePrice:r.medianPrice):c.map(r=>l==="average"?r.averagePrice:r.medianPrice)}})(),type:"scatter",mode:"lines+markers",name:`${l==="average"?"Average":"Median"} Price`,line:{color:"#2e7d32",width:2},marker:{size:6}}],layout:{autosize:!0,margin:{l:60,r:40,t:20,b:60},xaxis:{title:"Hour of Day",tickmode:"linear",tick0:0,dtick:2,range:[-.5,23.5]},yaxis:{title:`${l==="average"?"Average":"Median"} Price ($/kWh)`},showlegend:!1},style:{width:"100%",height:"400px"},config:{responsive:!0}})]})}),e.jsx(v,{sx:{padding:2},children:e.jsxs(o,{spacing:2,children:[e.jsx(n,{variant:"h6",fontWeight:"bold",children:"Price Over Time"}),e.jsx(A,{data:[{x:s.map(a=>a.datetime),y:s.map(a=>a.price),type:"scatter",mode:"lines",name:"Price ($/kWh)",line:{color:"#1976d2"}}],layout:{autosize:!0,margin:{l:60,r:40,t:20,b:80},xaxis:{title:"Date/Time",tickangle:-45},yaxis:{title:"Price ($/kWh)"},showlegend:!1},style:{width:"100%",height:"400px"},config:{responsive:!0}})]})}),e.jsx(v,{sx:{padding:2},children:e.jsxs(o,{spacing:2,children:[e.jsxs(o,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[e.jsx(n,{variant:"h6",fontWeight:"bold",children:"Outdoor Air Temperature"}),e.jsxs(k,{size:"small",sx:{minWidth:150},children:[e.jsx(T,{id:"city-select-label",children:"City"}),e.jsxs(W,{labelId:"city-select-label",id:"city-select",value:P,label:"City",onChange:a=>F(a.target.value),children:[e.jsx(g,{value:"San Jose",children:"San Jose, CA"}),e.jsx(g,{value:"Berkeley",children:"Berkeley, CA"}),e.jsx(g,{value:"Sacramento",children:"Sacramento, CA"})]})]})]}),b.loading&&e.jsx(n,{children:"Loading temperature data..."}),b.error&&e.jsxs(n,{color:"error",children:["Error loading temperature: ",b.error]}),!b.loading&&!b.error&&b.data.length>0&&e.jsx(A,{data:[{x:b.data.map(a=>a.datetime),y:b.data.map(a=>a.temperature),type:"scatter",mode:"lines",name:"Temperature (°F)",line:{color:"#d32f2f"}}],layout:{autosize:!0,margin:{l:60,r:40,t:20,b:80},xaxis:{title:"Date/Time",tickangle:-45},yaxis:{title:"Temperature (°F)"},showlegend:!1},style:{width:"100%",height:"400px"},config:{responsive:!0}})]})})]}):e.jsx(v,{sx:{padding:2},children:e.jsx(n,{children:"No statistics available"})}):e.jsx(v,{sx:{padding:2},children:e.jsx(n,{children:"No file selected"})})}const be=function(){const{id:t}=J.useParams(),{data:s}=Y({dataSource:"dummy-data/file-entities.json",dataIdField:"name",paramId:t,queryMode:"client",staticParams:null});return e.jsxs(O,{children:[e.jsx(X,{pageTitle:s?`${s.name}.csv`:"",breadcrumbTitle:"File Detail",sx:{marginBottom:1,padding:2}}),e.jsx(V,{maxWidth:"xl",children:e.jsx(o,{children:e.jsx(he,{filename:s?s.name:""})})})]})};export{be as component};
