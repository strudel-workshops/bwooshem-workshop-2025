import{g as U,a as Y,d as h,e as J,_ as O,b as S,j as e,s as V,h as X,k as q,a2 as Z,a3 as ee,y as ae,B as re,v as te,C as ie,S as o,P as b,T as i,a4 as se,a5 as F,a6 as d,a7 as ne,a8 as W,a9 as D,aa as $}from"./index-CcL4YOBG.js";import{A as le}from"./ArrowBack-CYRNa-9v.js";import{P as oe}from"./PageHeader-CFOspijT.js";import{u as ce}from"./useDetailQuery-BHN9f_6j.js";import{u as de}from"./useCSVStatistics-B1mErMTF.js";import{P as _}from"./react-plotly-Bw8H3Pw2.js";import{M as j}from"./MenuItem-CQLuTLmY.js";import"./useQuery-C8ToZMD9.js";import"./index-Chjiymov.js";import"./dividerClasses-D_XHDjYw.js";function he(s){return U("MuiTableContainer",s)}Y("MuiTableContainer",["root"]);const ue=["className","component"],xe=s=>{const{classes:t}=s;return q({root:["root"]},he,t)},ge=V("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(s,t)=>t.root})({width:"100%",overflowX:"auto"}),me=h.forwardRef(function(t,n){const c=J({props:t,name:"MuiTableContainer"}),{className:u,component:x="div"}=c,p=O(c,ue),g=S({},c,{component:x}),f=xe(g);return e.jsx(ge,S({ref:n,as:x,className:X(f.root,u),ownerState:g},p))});function pe(s){return U("MuiTableHead",s)}Y("MuiTableHead",["root"]);const je=["className","component"],fe=s=>{const{classes:t}=s;return q({root:["root"]},pe,t)},ye=V("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(s,t)=>t.root})({display:"table-header-group"}),be={variant:"head"},L="thead",we=h.forwardRef(function(t,n){const c=J({props:t,name:"MuiTableHead"}),{className:u,component:x=L}=c,p=O(c,je),g=S({},c,{component:x}),f=fe(g);return e.jsx(Z.Provider,{value:be,children:e.jsx(ye,S({as:x,className:X(f.root,u),ref:n,role:x===L?null:"rowgroup",ownerState:g},p))})}),ve={"San Jose":{lat:37.3382,lon:-121.8863},Berkeley:{lat:37.8715,lon:-122.273},Sacramento:{lat:38.5816,lon:-121.4944}};function Pe(s,t,n){const[c,u]=h.useState([]),[x,p]=h.useState(!1),[g,f]=h.useState(null);return h.useEffect(()=>{if(!s||!t||!n){u([]),p(!1),f(null);return}(async()=>{p(!0),f(null);try{const l=ve[s];if(!l)throw new Error(`Unknown city: ${s}`);const A=`https://archive-api.open-meteo.com/v1/archive?latitude=${l.lat}&longitude=${l.lon}&start_date=${t}&end_date=${n}&hourly=temperature_2m&temperature_unit=fahrenheit&timezone=America/Los_Angeles`,y=await fetch(A);if(!y.ok)throw new Error(`Failed to fetch weather data: ${y.statusText}`);const v=await y.json();if(!v.hourly||!v.hourly.time||!v.hourly.temperature_2m)throw new Error("Invalid weather data format");const m=v.hourly.time.map((R,C)=>({datetime:R,temperature:v.hourly.temperature_2m[C]}));u(m)}catch(l){f(l instanceof Error?l.message:"Failed to fetch weather data"),u([])}finally{p(!1)}})()},[s,t,n]),{data:c,loading:x,error:g}}function ke({filename:s}){const{stats:t,data:n,monthlyStats:c,hourlyProfile:u,weekdayHourlyProfile:x,weekendHourlyProfile:p,monthlyHourlyProfiles:g,loading:f,error:M}=de(s),[l,A]=h.useState("average"),[y,v]=h.useState("all"),[m,R]=h.useState("all"),[C,Q]=h.useState("San Jose"),[T,P]=h.useState(null),[z,I]=h.useState(null),[E,H]=h.useState(null),[N,B]=h.useState(0),k=n.length>0?{startDate:n[0].datetime.split(" ")[0],endDate:n[n.length-1].datetime.split(" ")[0]}:null,G=a=>{a["xaxis.range[0]"]&&a["xaxis.range[1]"]?P([a["xaxis.range[0]"],a["xaxis.range[1]"]]):a["xaxis.autorange"]&&P(null),a["yaxis.range[0]"]&&a["yaxis.range[1]"]?I([a["yaxis.range[0]"],a["yaxis.range[1]"]]):a["yaxis.autorange"]&&I(null),a.autosize&&(P(null),I(null)),B(r=>r+1)},K=a=>{a["xaxis.range[0]"]&&a["xaxis.range[1]"]?P([a["xaxis.range[0]"],a["xaxis.range[1]"]]):a["xaxis.autorange"]&&P(null),a["yaxis.range[0]"]&&a["yaxis.range[1]"]?H([a["yaxis.range[0]"],a["yaxis.range[1]"]]):a["yaxis.autorange"]&&H(null),a.autosize&&(P(null),H(null)),B(r=>r+1)},w=Pe(C,(k==null?void 0:k.startDate)||null,(k==null?void 0:k.endDate)||null);return s?f?e.jsx(b,{sx:{padding:2},children:e.jsx(i,{children:"Loading CSV data..."})}):M?e.jsx(b,{sx:{padding:2},children:e.jsxs(i,{color:"error",children:["Error: ",M]})}):t?e.jsxs(o,{spacing:3,children:[e.jsx(b,{sx:{padding:2},children:e.jsxs(o,{spacing:2,children:[e.jsxs(i,{variant:"h6",fontWeight:"bold",children:["Data Summary for ",s,".csv"]}),e.jsxs(o,{spacing:1,children:[e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(i,{fontWeight:"bold",children:"Number of datapoints:"}),e.jsx(i,{children:t.count.toLocaleString()})]}),e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(i,{fontWeight:"bold",children:"Average Price ($/kWh):"}),e.jsxs(i,{children:["$",t.average]})]}),e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(i,{fontWeight:"bold",children:"Median Price ($/kWh):"}),e.jsxs(i,{children:["$",t.median]})]}),e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(i,{fontWeight:"bold",children:"Maximum Price ($/kWh):"}),e.jsxs(i,{children:["$",t.max]})]}),e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(i,{fontWeight:"bold",children:"Minimum Price ($/kWh):"}),e.jsxs(i,{children:["$",t.min]})]}),e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(i,{fontWeight:"bold",children:"Average Daily Price Delta ($/kWh):"}),e.jsxs(i,{children:["$",t.averageDailyPriceDelta]})]})]})]})}),e.jsx(b,{sx:{padding:2},children:e.jsxs(o,{spacing:2,children:[e.jsx(i,{variant:"h6",fontWeight:"bold",children:"Monthly Statistics"}),e.jsx(me,{children:e.jsxs(se,{children:[e.jsx(we,{children:e.jsxs(F,{children:[e.jsx(d,{children:e.jsx("strong",{children:"Month"})}),e.jsx(d,{align:"right",children:e.jsx("strong",{children:"Average ($/kWh)"})}),e.jsx(d,{align:"right",children:e.jsx("strong",{children:"Median ($/kWh)"})}),e.jsx(d,{align:"right",children:e.jsx("strong",{children:"Max ($/kWh)"})}),e.jsx(d,{align:"right",children:e.jsx("strong",{children:"Min ($/kWh)"})}),e.jsx(d,{align:"right",children:e.jsx("strong",{children:"Avg Daily Delta ($/kWh)"})}),e.jsx(d,{align:"right",children:e.jsx("strong",{children:"Data Points"})})]})}),e.jsx(ne,{children:c.map(a=>e.jsxs(F,{hover:!0,children:[e.jsx(d,{children:a.month}),e.jsxs(d,{align:"right",children:["$",a.average]}),e.jsxs(d,{align:"right",children:["$",a.median]}),e.jsxs(d,{align:"right",children:["$",a.max]}),e.jsxs(d,{align:"right",children:["$",a.min]}),e.jsxs(d,{align:"right",children:["$",a.averageDailyPriceDelta]}),e.jsx(d,{align:"right",children:a.count.toLocaleString()})]},a.month))})]})})]})}),e.jsx(b,{sx:{padding:2},children:e.jsxs(o,{spacing:2,children:[e.jsxs(o,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[e.jsx(i,{variant:"h6",fontWeight:"bold",children:"Typical Daily Profile"}),e.jsxs(o,{direction:"row",spacing:2,flexWrap:"wrap",children:[e.jsxs(W,{size:"small",sx:{minWidth:150},children:[e.jsx(D,{id:"month-filter-label",children:"Time Period"}),e.jsxs($,{labelId:"month-filter-label",id:"month-filter-select",value:y,label:"Time Period",onChange:a=>v(a.target.value),children:[e.jsx(j,{value:"all",children:"All Data"}),g.map(a=>e.jsx(j,{value:a.month,children:a.month},a.month))]})]}),e.jsxs(W,{size:"small",sx:{minWidth:120},children:[e.jsx(D,{id:"day-type-label",children:"Day Type"}),e.jsxs($,{labelId:"day-type-label",id:"day-type-select",value:m,label:"Day Type",onChange:a=>R(a.target.value),children:[e.jsx(j,{value:"all",children:"All Days"}),e.jsx(j,{value:"weekday",children:"Weekday"}),e.jsx(j,{value:"weekend",children:"Weekend"})]})]}),e.jsxs(W,{size:"small",sx:{minWidth:120},children:[e.jsx(D,{id:"hourly-metric-label",children:"Metric"}),e.jsxs($,{labelId:"hourly-metric-label",id:"hourly-metric-select",value:l,label:"Metric",onChange:a=>A(a.target.value),children:[e.jsx(j,{value:"average",children:"Average"}),e.jsx(j,{value:"median",children:"Median"})]})]})]})]}),e.jsx(_,{data:[{x:(()=>{if(y==="all")return m==="weekday"?x.map(a=>a.hour):m==="weekend"?p.map(a=>a.hour):u.map(a=>a.hour);{const a=g.find(r=>r.month===y);return a?m==="weekday"?a.weekdayProfile.map(r=>r.hour):m==="weekend"?a.weekendProfile.map(r=>r.hour):a.profile.map(r=>r.hour):u.map(r=>r.hour)}})(),y:(()=>{if(y==="all")return m==="weekday"?x.map(a=>l==="average"?a.averagePrice:a.medianPrice):m==="weekend"?p.map(a=>l==="average"?a.averagePrice:a.medianPrice):u.map(a=>l==="average"?a.averagePrice:a.medianPrice);{const a=g.find(r=>r.month===y);return a?m==="weekday"?a.weekdayProfile.map(r=>l==="average"?r.averagePrice:r.medianPrice):m==="weekend"?a.weekendProfile.map(r=>l==="average"?r.averagePrice:r.medianPrice):a.profile.map(r=>l==="average"?r.averagePrice:r.medianPrice):u.map(r=>l==="average"?r.averagePrice:r.medianPrice)}})(),type:"scatter",mode:"lines+markers",name:`${l==="average"?"Average":"Median"} Price`,line:{color:"#2e7d32",width:2},marker:{size:6}}],layout:{autosize:!0,margin:{l:60,r:40,t:20,b:60},xaxis:{title:"Hour of Day",tickmode:"linear",tick0:0,dtick:2,range:[-.5,23.5]},yaxis:{title:`${l==="average"?"Average":"Median"} Price ($/kWh)`},showlegend:!1},style:{width:"100%",height:"400px"},config:{responsive:!0}})]})}),e.jsx(b,{sx:{padding:2},children:e.jsxs(o,{spacing:2,children:[e.jsx(i,{variant:"h6",fontWeight:"bold",children:"Price Over Time"}),e.jsx(_,{data:[{x:n.map(a=>a.datetime),y:n.map(a=>a.price),type:"scatter",mode:"lines",name:"Price ($/kWh)",line:{color:"#1976d2"}}],layout:{autosize:!0,margin:{l:60,r:40,t:20,b:80},xaxis:{title:"Date/Time",tickangle:-45,...T&&{range:T,autorange:!1}},yaxis:{title:"Price ($/kWh)",...z&&{range:z,autorange:!1}},showlegend:!1},revision:N,style:{width:"100%",height:"400px"},config:{responsive:!0},onRelayout:G})]})}),e.jsx(b,{sx:{padding:2},children:e.jsxs(o,{spacing:2,children:[e.jsxs(o,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[e.jsx(i,{variant:"h6",fontWeight:"bold",children:"Outdoor Air Temperature"}),e.jsxs(W,{size:"small",sx:{minWidth:150},children:[e.jsx(D,{id:"city-select-label",children:"City"}),e.jsxs($,{labelId:"city-select-label",id:"city-select",value:C,label:"City",onChange:a=>Q(a.target.value),children:[e.jsx(j,{value:"San Jose",children:"San Jose, CA"}),e.jsx(j,{value:"Berkeley",children:"Berkeley, CA"}),e.jsx(j,{value:"Sacramento",children:"Sacramento, CA"})]})]})]}),w.loading&&e.jsx(i,{children:"Loading temperature data..."}),w.error&&e.jsxs(i,{color:"error",children:["Error loading temperature: ",w.error]}),!w.loading&&!w.error&&w.data.length>0&&e.jsx(_,{data:[{x:w.data.map(a=>a.datetime),y:w.data.map(a=>a.temperature),type:"scatter",mode:"lines",name:"Temperature (°F)",line:{color:"#d32f2f"}}],layout:{autosize:!0,margin:{l:60,r:40,t:20,b:80},xaxis:{title:"Date/Time",tickangle:-45,...T&&{range:T,autorange:!1}},yaxis:{title:"Temperature (°F)",...E&&{range:E,autorange:!1}},showlegend:!1},revision:N,style:{width:"100%",height:"400px"},config:{responsive:!0},onRelayout:K})]})})]}):e.jsx(b,{sx:{padding:2},children:e.jsx(i,{children:"No statistics available"})}):e.jsx(b,{sx:{padding:2},children:e.jsx(i,{children:"No file selected"})})}const He=function(){const{id:t}=ee.useParams(),n=ae(),{data:c}=ce({dataSource:"dummy-data/file-entities.json",dataIdField:"name",paramId:t,queryMode:"client",staticParams:null});return e.jsxs(re,{children:[e.jsx(oe,{pageTitle:c?`${c.name}.csv`:"",breadcrumbTitle:"File Detail",actions:e.jsx(te,{variant:"outlined",startIcon:e.jsx(le,{}),onClick:()=>n({to:"/explore-data"}),children:"Back to Files"}),sx:{marginBottom:1,padding:2}}),e.jsx(ie,{maxWidth:"xl",children:e.jsx(o,{children:e.jsx(ke,{filename:c?c.name:""})})})]})};export{He as component};
